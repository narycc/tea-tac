<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title> <!-- TO DO -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!-- PUBLIC STYLES: base.css -->
    <link rel="stylesheet" href="styles/css/base.css">
    <!-- PUBLIC STYLES END -->
    <script type="text/javascript" src="js/vendor/jquery.js"></script>
    <script type="text/javascript" src="js/vendor/bootstrap.js"></script>
    <script type="text/javascript" src="js/vendor/jquery.mobile.custom.min.js"></script>
    <script type="text/javascript" src="js/plugins/underscore.js"></script>

    <style type="text/css">
.panel-selector{background-color: #f3f3f3;
    position: fixed;
    width: 100%;height: 40%; min-height: 200px;
    bottom: -40%;
    transition: bottom .5s;
-moz-transition: bottom .5s; /* Firefox 4 */
-webkit-transition: bottom .5s; /* Safari 和 Chrome */
-o-transition: bottom .5s; /* Opera */
  }

    .panel-selector.hasShown{
      bottom: 0;
      transition: bottom .5s;
-moz-transition: bottom .5s; /* Firefox 4 */
-webkit-transition: bottom .5s; /* Safari 和 Chrome */
-o-transition: bottom .5s; /* Opera */
    }

    .panel-header{height: 36px; background-color: #696767;padding: 6px;}
    .panel-header button{border: 0;}
    .panel-header button.cancel{color: #b60005;margin-left: 10px;}
    .panel-header button.ok{color: #237b23;margin-right: 10px;}

    .panel-content{height: calc(100% - 40px); overflow: scroll;padding-top: 10px;}
    .panel-content li{padding: 5px 0; text-align: center;}

    .panel-content li a{ color: #333; }
    .panel-content li.selected a{color: #b60005;}

    </style>
  </head>
  <body>
    <div class="main-page liuxian-page-teacherRelease">
      <div class="container container-liuxian ">
        <div class="b-searchZone">
          <div class="b-img">
            <img src="images/header_option_2.jpg" alt="">
          </div>
          <div class="b-searchBar full-center text-white">
            <div class="form-group">
              <span class="glyphicon glyphicon-search i-search"></span>
              <input type="search" id="search_key" class="s-search form-control" placeholder="请输入学生姓名">
            </div>
          </div>
        </div>

        <div class="b-list row text-center b-list-selector">
          <div class="col-xs-6 b-button"><a href="javascript:void(0);" id="selector_classes">选择班级 <span class="glyphicon glyphicon-menu-down"></span></a></div>
          <div class="col-xs-6 b-button"><a href="javascript:void(0);" id="selector_groups">选择社团 <span class="glyphicon glyphicon-menu-down"></span></a></div>

          <div class="module-selector">
            <ul class="list-unstyled selector-content ul-classes">
              <li><a href="javascript:void(0)" cid="001">1年级1班</a></li>
              <li><a href="javascript:void(0)" cid="001">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
            </ul>
          </div>            
        </div>
       <!--  <div class="b-classes b-list">
          <h4>我的班级</h4>
          <ul class="list-unstyled ul-classes" id="teach_class">
          </ul>
        </div>

        <div class="b-groups b-list">
          <h4>我的社团</h4>
          <ul class="list-unstyled ul-classes" id="user_teams">-</ul>
        </div> -->

        <div class="b-state">
            <span class="b-cur-class" id="b-cur-class">少先队</span>
          </div>
        
        <div class="b-searchResult" id="student_list">
          <div class="row"><a href="javascript://" onclick="jump(\'main\', \'teacher\', {uid:'+item.id+'})" class="flex-center"><div class="col-xs-3 col-sm-4 b-img"><img src="images/defaultImage.jpg"></div><div class="col-xs-7 col-sm-6 text-left b-text"><div class="s-name">'+item.name+'</div><div class="s-project">'+item.grade+'年级'+item.class+'班</div></div><div class="col-xs-2 text-right"><span class="goto glyphicon glyphicon-menu-right"></span></div></a></div>
        </div>

        <div class="panel-selector">
          <div class="panel-header">
            <div class="row">
              <button class="pull-left cancel" id="panel-cancel">取消</button> <button class="pull-right ok" id="panel-ok">确定</button>
            </div>
          </div>

          <div class="panel-content">
            <ul class="list-unstyled">
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li class="selected"><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
              <li><a href="javascript:void(0)">1年级1班</a></li>
              <li><a href="javascript:void(0)">2年级1班</a></li>
              <li><a href="javascript:void(0)">3年级2班</a></li>
              <li><a href="javascript:void(0)">3年级3班</a></li>
            </ul>
          </div>
        </div>  

      </div>
    </div>
  </body>
</html>

<script type="text/javascript">
$(document).ready(function(){
  $('#selector_classes').on('click',function(){
    // 将所有的班级填充到panel-selector, panel-content 当中去；然后升上来
    if(! $('.module-selector').hasClass('hasShown')){
      $('.module-selector').addClass('hasShown');
    }else{
      $('.module-selector').removeClass('hasShown');

      loadClasses();
    }
    
    if( ! $(this).parent().hasClass('b-button-selected')){
      $('.b-list-selector .b-button').removeClass('b-button-selected');
      $('#selector_groups').html('选择社团 <span class="glyphicon glyphicon-menu-down"></span>');
    }

    $('.b-list-selector .b-button').removeClass('b-button-triggered');
    $(this).parent().addClass('b-button-triggered');
  });


  $('#selector_groups').on('click',function(){
    if(! $('.module-selector').hasClass('hasShown')){
      $('.module-selector').addClass('hasShown');
    }else{
      $('.module-selector').removeClass('hasShown');
      loadTeams();
    }

    $('.b-list-selector .b-button').removeClass('b-button-triggered');
    $(this).parent().addClass('b-button-triggered');

    if( ! $(this).parent().hasClass('b-button-selected')){
      $('.b-list-selector .b-button').removeClass('b-button-selected');
      $('#selector_classes').html('选择班级 <span class="glyphicon glyphicon-menu-down"></span>');
    }
  });


  $('.module-selector .selector-content').on('click','a',function(){
    var cid = $(this).attr('cid');
    var name = $(this).text();

    var _that = $('.b-list-selector .b-button-triggered');
    _that.addClass('b-button-selected').find('a').html(name + ' <span class="glyphicon glyphicon-menu-down"></span>');

    $('.module-selector').removeClass('hasShown');

    var type = $('.module-selector .selector-content').attr('data-type');
    if(type == 'classes'){
      cur_checked_class = cid;
      cur_checked_team = 0;
    }else{
      cur_checked_team = cid;
      cur_checked_class = 0;
    }

    getStudentLists();

  });
  
});

</script>
<script src="js/api.js"></script>
<script>
  var userinfo = {};
  var cur_checked_class = 0;
  var cur_checked_team = 0;
  var checked_sids = [];

  function init(){
    $('#check_all_btn').on('click',function(){
      checkStudentAll();
    });
    $('#next_step').on('click',function(){
      //alert(JSON.stringify({member_id:checked_sids}));
      jump('uploadProject', 'workRelease', {member_id:checked_sids})
    });
    if(api.pageParam.user){
      userinfo =api.pageParam.user;
      initPage(userinfo);
    }else{
      userinfo = $api.getStorage('uinfo');
      if(!userinfo || !userinfo.id){
        jump('login', 'teacher');
        return false;
      }else{
        initPage(userinfo);
      }
    }
    $('#search_key').on('blur',function(){
      getStudentLists();
    });
  }

  function initPageTitle(){
    var title = '我的学生';

    api.sendEvent({
        name: 'changePage',
        extra: {
          pageTo: 'index', 
          pageFrom: 'main',
          pageTitle: title,
        }
    });
  }

  function loadClasses(){
    if(userinfo.teach_class){
      var  teach_class = userinfo.teach_class;
      var html = '';
      var i = 0;
      for(var k in teach_class){
        
        html += '<li><a href="javascript:void(0);" cid="'+teach_class[k].class+'">'+parseInt(teach_class[k].class/100)+'年级'+parseInt(teach_class[k].class%100)+'班</a></li>';
      }
      $('.module-selector .selector-content').attr('data-type','classes').html(html);
      
    }else{
      $('.module-selector .selector-content').attr('data-type','classes').html('暂无数据');
    }
  }

  function loadTeams(){
    if(userinfo.teams){
      var teams = userinfo.teams;
      var len = teams.length;
      var tmp_html = '';
      for(var i=0; i<len; i++){
        tmp_html += '<li><a href="javascript:void(0)" cid="'+teams[i]['id']+'">'+teams[i]['title']+'</a></li>';
      }
      $('.module-selector .selector-content').attr('data-type','teams').html(html);
    }else{
      $('.module-selector .selector-content').attr('data-type','teams').html('暂无数据');
    }
  }

  function initTeachClass(userinfo){
    if(userinfo.teach_class){
      var  teach_class = userinfo.teach_class;
      var html = '';
      var i = 0;
      for(var k in teach_class){
        if(i==0){
          cur_checked_class = teach_class[k].class;
          checked_cs = 'class="checked"';
          $('.b-cur-class').text(parseInt(cur_checked_class/100)+'年级'+parseInt(cur_checked_class%100)+'班');
        }else{
          checked_cs = '';
        }
        html += '<li cid="'+teach_class[k].class+'" '+checked_cs+'>'+parseInt(teach_class[k].class/100)+'年级'+parseInt(teach_class[k].class%100)+'班</li>';
        i++;
      }
      $('#teach_class').html(html);
      $('#teach_class li').on('click',function(){
        changeClassVal(this);
      });
    }

    if(userinfo.teams){
      var teams = userinfo.teams;
      var len = teams.length;
      var tmp_html = '';
      for(var i=0; i<len; i++){
        tmp_html += '<li cid="'+teams[i]['id']+'">'+teams[i]['title']+'</li>';
      }
      $('#user_teams').html(tmp_html);
      $('#user_teams li').on('click',function(){
        changeTeamVal(this);
      });
    }

    getStudentLists();
  }

  function changeClassVal(obj){
    var id_str = $(obj).attr('cid');
    cur_checked_class = id_str;

    $('#user_teams li').each(function(){
      $(this).removeClass('checked');
    });

    cur_checked_team = 0;

    $('#teach_class li').each(function(){
      if($(this).attr('cid') == id_str){
        $(this).addClass('checked');
      }else{
        $(this).removeClass('checked');
      }
    });

    $('.b-cur-class').text(parseInt(id_str/100)+'年级'+parseInt(id_str%100)+'班');

    getStudentLists();
  }

  function changeTeamVal(obj){
    var id_str = $(obj).attr('cid');
    cur_checked_team = id_str;

    $('#teach_class li').each(function(){
      $(this).removeClass('checked');
    });

    cur_checked_class = 0;

    $('#user_teams li').each(function(){
      if($(this).attr('cid') == id_str){
        $(this).addClass('checked');
      }else{
        $(this).removeClass('checked');
      }
    });

    $('.b-cur-class').text($(obj).html());

    getStudentLists();
  }

  function initPage(userinfo){
    initPageTitle();
    initFocusEvent();
    initTeachClass(userinfo);
  }

  function getStudentLists(){
    var uid = userinfo.id;
    name = $('#search_key').val();
    //alert(JSON.stringify({search:1, name:name, class_id:cur_checked_class, 'team_id':cur_checked_team}));
    ajaxRequest('User/getUser', 'GET', {search:1, name:name, class_id:cur_checked_class, 'team_id':cur_checked_team}, function(ret,err){
      if(ret.code == 0 && ret.data && ret.data.list && ret.data.list.length>0){
        var list = ret.data.list;
        var len = list.length;
        var html = '';
        for(var i=0; i<len; i++){
          item = list[i];
          html += '<div class="row "><a href="javascript://" onclick="jump(\'main\', \'teacher\', {uid:'+item.id+'})" class="flex-center"><div class="col-xs-3 col-sm-4 b-img"><img src="'+(item.avatar?item.avatar:'images/defaultImage.jpg')+'"></div><div class="col-xs-7 col-sm-6 text-left b-text"><div class="s-name">'+item.name+'</div><div class="s-project">'+item.grade+'年级'+item.class+'班</div></div><div class="col-xs-2 text-right"><span class="goto glyphicon glyphicon-menu-right"></span></div></a></div>';
        }
        $('#student_list').html(html);
      }else{
        $('#student_list').html('<div class="row"><div class="col-xs-12" style="text-align:center;"><h3>没搜索到相关学生</h3></div></div>');
      }
    });
  }

  function initFocusEvent(){
    api.addEventListener({
        name: 'switchFrame'
    }, function( ret, err ){
        //重获焦点
        var data = ret.value;
        if(data.page == 'viewStudent'){
            init();
        }
    });
  }

  apiready = function(){
    init();
    //listenExitApp();
  };
</script>